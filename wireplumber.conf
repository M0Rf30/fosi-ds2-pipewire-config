# Minimal WirePlumber configuration for Fosi DS2
# Configuration section for device-level settings and properties
device-settings = {
  # Array of rules to match and configure audio devices
  rules = [
    # Rule to match and configure the Fosi DS2 audio device
    {
      # Conditions to match specific devices
      matches = [
        # Match device by name using regex pattern (~ prefix enables regex)
        {
          # Regex pattern matches the ALSA card name for Fosi DS2 device
          "device.name" = "~alsa_card.usb-Speed_Dragon_Fosi_Audio_DS2_5000000001-01"
        }
      ]
      # Properties to apply when device matches the conditions
      apply = {
        # ALSA card index for the device (1 = second card, typically first USB device)
        "api.alsa.card" = 1
        # Default profile name to use for the device (pro-audio for high-resolution)
        "device.profile.name" = "pro-audio"
        # Dynamic sample rate switching - 0 allows rate to adapt to source
        "audio.rate" = 0
        # Number of audio channels (2 for stereo output)
        "audio.channels" = 2
        # Channel positions for stereo configuration (Front Left, Front Right)
        "audio.position" = [FL FR]
      }
    }
  ]
}

# Configuration section for node-level settings and properties
node-settings = {
  # Array of rules to match and configure PipeWire nodes
  rules = [
    # Rule to match and configure Fosi DS2 output nodes
    {
      # Conditions to match specific nodes
      matches = [
        # Match output nodes by name using regex pattern
        {
          # Regex pattern matches Fosi DS2 output node names (.* matches any suffix)
          "node.name" = "~alsa_output.usb-Speed_Dragon_Fosi_Audio_DS2_5000000001-01.*"
        }
      ]
      # Properties to apply when node matches the conditions
      apply = {
        # Supported audio formats for the node (S16/S24/S32/F32 - no DSD in minimal config)
        "audio.format" = [S16 S24 S24_32 S32 F32]
        # Dynamic sample rate switching - 0 allows rate to adapt to source material
        "audio.rate" = 0
        # Number of audio channels (2 for stereo)
        "audio.channels" = 2
        # Channel positions for stereo setup (Front Left, Front Right)
        "audio.position" = [FL FR]
        # Don't force a specific sample rate (0 = allow dynamic switching)
        "node.force-rate" = 0
        # Allow sample rate to change dynamically when needed (false = unlocked)
        "node.lock-rate" = false
      }
    }
  ]
}

# Policy configuration for default audio nodes (sets default sink/source)
policy-default-nodes = {
  # Configuration for default audio sink (output device)
  "Audio/Sink" = {
    # Priority list of sink names to use as default, in order of preference
    priority = [
      # Fosi DS2 output node as first priority (highest priority device)
      "alsa_output.usb-Speed_Dragon_Fosi_Audio_DS2_5000000001-01.*"
    ]
  }
}
