# Minimal PipeWire configuration for Fosi DS2
# Sets global context properties for the PipeWire daemon
context.properties = {
  # Default sample rate for the PipeWire graph (48kHz base for compatibility)
  default.clock.rate = 48000
  # List of supported sample rates for dynamic switching (CS43131 supports up to 384kHz)
  default.clock.allowed-rates = [44100 48000 96000 176400 192000 352800 384000]
  # Minimum quantum size in frames for low latency operation (32 frames = ~0.67ms at 48kHz)
  default.clock.min-quantum = 32
  # Default quantum size in frames (256 frames = ~5.33ms at 48kHz)
  default.clock.quantum = 256
  # Don't force a specific sample rate, allow dynamic switching based on source material
  node.force-rate = 0
  # Allow sample rate to change dynamically when new streams connect
  node.lock-rate = false
}

# Defines rules for matching and configuring PipeWire nodes
node.rules = [
  # Rule for Fosi DS2 audio output device
  {
    # Conditions to match specific nodes
    matches = [
      # Match Fosi DS2 by node name pattern using regex (~ prefix)
      {
        # Regex pattern matches the actual PipeWire node name for Fosi DS2
        node.name = "~alsa_output.usb-Speed_Dragon_Fosi_Audio_DS2_5000000001-01.*"
      }
    ]
    # Actions to perform when a node matches the conditions
    actions = {
      # Update node properties to configure audio parameters
      update-props = {
        # Supported audio formats for the device (S16/S24/S32/F32/F64 - no DSD in minimal config)
        audio.format = [S16 S24 S24_32 S32 F32 F64]
        # Sample rate = 0 means dynamic rate switching based on source material
        audio.rate = 0
        # Number of audio channels (2 for stereo)
        audio.channels = 2
        # Channel positions for stereo (Front Left, Front Right)
        audio.position = [FL FR]
        # Enable multi-rate support in ALSA plugin for dynamic sample rate switching
        api.alsa.multi-rate = true
      }
    }
  }
]
